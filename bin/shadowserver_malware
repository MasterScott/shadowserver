#!/usr/bin/env ruby
require 'shadowserver'
require 'digest/md5'
require 'pp'

def usage
	puts "Usage: #{$0} (<hash>|<filename>) [<hash>|<filename> ...]"
	puts "this tool will query the malware list for each hash or filename provided at the commandline"
	exit
end

usage unless ARGV.length > 0

ARGV.each do |item|
	if item =~ /^[a-f0-9]{32}([a-f0-9]{8})?$/i
		pp Shadowserver::Malware.query(item)
	elsif File.exists?(item)
		hash = Digest::MD5.hexdigest(File.open(item).read)
		pp Shadowserver::Malware.query(hash)
	else
		puts "#{item} isn't a hash or a filename (that I can find)"
	end
end
